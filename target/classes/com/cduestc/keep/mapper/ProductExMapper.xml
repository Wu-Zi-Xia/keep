<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cduestc.keep.mapper.ProductExMapper">
    <resultMap id="BaseResultMap" type="com.cduestc.keep.model.Product">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Fri Apr 17 18:49:56 CST 2020.
        -->
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="category_id" jdbcType="BIGINT" property="categoryId" />
        <result column="public_attribute" jdbcType="VARCHAR" property="publicAttribute" />
        <result column="attribute_list" jdbcType="VARCHAR" property="attributeList" />
        <result column="create_date" jdbcType="BIGINT" property="createDate" />
        <result column="modify_date" jdbcType="BIGINT" property="modifyDate" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="description" jdbcType="VARCHAR" property="description" />
        <result column="urls" jdbcType="VARCHAR" property="urls" />
        <result column="price" jdbcType="VARCHAR" property="price" />
        <result column="seller_count" jdbcType="INTEGER" property="sellerCount" />
    </resultMap>
<select id="selectByLimit" resultType="com.cduestc.keep.model.Product" parameterType="map">
        select
        id,urls,description,name,price,seller_count
        from product
        WHERE category_id in<foreach item="item" index="index" collection="ids" open="(" close=")" separator=",">#{item}</foreach>
        order by seller_count desc
        limit #{page,jdbcType=INTEGER},#{offsize,jdbcType=INTEGER}
</select>
    <select id="countBySearch" parameterType="java.lang.String" resultType="java.lang.Long">
        select count(*) from product
        <where>
            <if test="search != null and search!= ''">
                and  name regexp #{search}
            </if>
        </where>
    </select>

    <select id="selectBySearch" parameterType="com.cduestc.keep.provider.ProductSelectParam" resultType="com.cduestc.keep.pojo.ProductSimpleINFO">
        select id,name,urls,description,price
        from product
        where name regexp #{search}
        limit #{offset},#{size}
    </select>
    <select id="selectParentIdByid" parameterType="java.lang.Long" resultType="java.lang.Long">
        select parent_id from product_category where id=(select category_id from product where id=#{productId})
    </select>
</mapper>